<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>


<br>
<br>
<p>Resource Query</p>
<br>

<br>
<br>
<p>Data: (Optional)</p>
<br>
Author <input type="text" name="author" value="">
<br>
Rating <input type="text" name="rating" placeholder="5" list="ratings">
<br>
Review <input type="text" name="reviewText">
<br>
<button>Make Request</button>

<h3>Results</h3>
<input name="query">
<br>
<textarea name="results" readonly></textarea>

<script>
    let callBtn = document.querySelector('button')


    const makeCall = ()=>{
        let data = {
            'author':document.querySelector('input[name="author"]').value,
            'rating':document.querySelector('input[name="rating"]').value,
            'reviewText':document.querySelector('textarea[name="results"]').value,


        }



        let verbField = document.querySelector('select[name="verb"]')
        let verb = verbField.options[verbField.selectedIndex].value
        let resource = document.querySelector('input[name="resource"]')
        let results = document.querySelector('textarea[name="results"]')
        let url = `http://localhost:3000/api/v1/${resource}`

        document.querySelector('input[name="query"]').value.url

        let myHeaders = new Headers()

        myHeaders.set('Content-Type', 'application/json')

        let myInit = {
            method:verb,
            headers:myHeaders,
            mode:'cors',
            cache:'default'
        }

        if(['POST','PUT'].indexOf(verb) > -1){
            myInit.body = JSON.stringify(data)

        }

        let myRequest = new Request(url, myInit)

        fetch(myRequest).then(response => {
            let contentType = response.headers.get('content-type')
            if(contentType && contentType.includes('application/json')){
                return response.text()
            }

            if(response.status === 204){
                return 'Delete'
            }
            throw new TypeError("This isn't JSON.")

        }).then(jsonText =>{
            results.value = jsonText
        }).catch(err =>{
            console.log(err)
        })

    }
    callBtn.addEventListener('click', makeCall)
</script>
</body>
</html>
